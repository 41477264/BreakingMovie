<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="favicon/x-icon" href="../img/Logo.png">
  <title>Breaking Movie</title>

  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/style-promociones.css">
  <script src="https://kit.fontawesome.com/5749bb9092.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script defer src="../js/style.js"></script>
  <script src="../js/scrollreveal.js"></script>
</head>

<body>
  <!--INICIO DE CABECERA-->
  <header class="header">
    <nav class="nav">
      <a href="../index.html" class="logo">
        <img src="../img/Logo.png" alt="BreakingMovie">
      </a>

      <button class="nav-toggle" aria-label="Abrir menú">
        <i class="fas fa-bars"></i>
      </button>

      <ul class="nav-menu">
        <li class="nav-menu-item"><a href="../vistas/vistas-peliculas.html" class="nav-menu-link nav-link">Peliculas</a>
        </li>
        <li class="nav-menu-item"><a href="../vistas/Lugares.html" class="nav-menu-link nav-link">Cines</a></li>
        <li class="nav-menu-item"><a href="../vistas/vistas-promociones.html"
            class="nav-menu-link nav-link">Dulcerías/Promociones</a></li>
        <li class="nav-menu-item"><a href="../vistas/contacto.html" class="nav-menu-link nav-link">Contacto</a></li>
        <li class="nav-menu-item"><a href="../vistas/login.html" class="nav-menu-link nav-link">Login</a></li>
      </ul>

      <div class="carritoCompra">
        <img onmouseover="showCart(this)" class="cart" src="../img/carrito.jpg" alt="">
        <p class="count-product">0</p>
      </div>
      <div class="cart-products" id="products-id">
        <p class="close-btn" onclick="closeBtn()">X</p>
        <h3>Mi carrito</h3>
        <div class="card-items">
          <!-- <div class="item">
                              <img src="../img/products/keyboard-1.jpg" alt="">
                              <div class="item-content">
                                  <h5>name of product name of product name of product</h5>
                                  <h5 class="cart-price">45.50$</h5>
                                  <h6>Amount: 3</h6>
                              </div>
                              <span>X</span>
                          </div>
          
                          <div class="item">
                              <img src = "../img/products/keyboard-1.jpg" alt="">
                              <div class="item-content">
                                  <h5>name of product name of product name of product</h5>
                                  <h5 class="cart-price">45.50$</h5>
                                  <h6>Amount: 3</h6>
                              </div>
                              <span class="delete-product" data-id="">X</span>
                          </div> -->
        </div>
        <h2>Total: S/<strong class="price-total" id="idPrecio">0</strong></h2>
        <input type="button" value="Comprar" id="btn-comprar">
      </div>
    </nav>
  </header>
  <!--FIN DE CABECARA-->
  <div class="clearfix"></div>

  <!--INICIO DE BODY-->
  <main>
    <section class="container">
      <div class="products">
        <div class="carts">
          <div>
            <img src="../img/products/peli1.jpg" alt="">
            <p>S/<span>20</span></p>
          </div>
          <p class="title">Proyecto Geminis</p>
          <a href="" data-id="1" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli2.jpg" alt="">
            <p>S/<span>35</span></p>
          </div>
          <p class="title"> Malefica</p>
          <a href="" class="btn-add-cart" data-id="2">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli3.jpg" alt="">
            <p>S/<span>15.50</span></p>
          </div>
          <p class="title"> Aladdin</p>
          <a href="" data-id="3" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli4.jpg" alt="">
            <p>S/<span>20.20</span></p>
          </div>
          <p class="title"> The Wolverine</p>
          <a href="" data-id="4" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli5.jpg" alt="">
            <p>S/<span>19</span></p>
          </div>
          <p class="title"> Civil War</p>
          <a href="" data-id="5" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli6.jpg" alt="">
            <p>S/<span>45</span></p>
          </div>
          <p class="title"> Señor de los anillos</p>
          <a href="" data-id="6" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli7.jpg" alt="">
            <p>S/<span>23.99</span></p>
          </div>
          <p class="title"> Godzilla</p>
          <a href="" data-id="7" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/peli8.jpg" alt="">
            <p>S/<span>50</span></p>
          </div>
          <p class="title"> Harry Potter</p>
          <a href="" data-id="8" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/comida1.jpg" alt="">
            <p>S/<span>16</span></p>
          </div>
          <p class="title"> Popcorn</p>
          <a href="" data-id="9" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/comida2.jpg" alt="">
            <p>S/<span>17.50</span></p>
          </div>
          <p class="title"> Wantan</p>
          <a href="" data-id="10" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/comida3.jpg" alt="">
            <p>S/<span>45</span></p>
          </div>
          <p class="title"> Combo 1</p>
          <a href="" data-id="11" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts">
          <div>
            <img src="../img/products/comida4.jpg" alt="">
            <p>S/<span>45</span></p>
          </div>
          <p class="title"> Combo 2</p>
          <a href="" data-id="12" class="btn-add-cart">Lo quiero</a>
        </div>
        <div class="carts" id="cajaPrueba">
          <div>
            <input type="text" id="txt-prueba" class="alm-tem">
            <input type="text" id="txt-prueba2" class="alm-tem">
            <input type="text" id="txt-prueba3" class="alm-tem">
          </div>
          <p class="title"> Combo 2</p>
          <a href="" data-id="13" class="btn-add-cart">Lo quiero</a>
        </div>
      </div>
    </section>
    <section>
      <div class="carts mostrarProducto">
        <a href="./mostrarProducto.html" class="btn-add-cart">Mostrar Producto</a>
      </div>
    </section>
  </main>

  <div class="clearfix"></div>

  <!---INICIO DE PIE DE PAGINA-->
  <footer class="footer">
    <div class="grupo-1">
      <div class="box">
        <ul>
          <li><a href="../vistas/somos.html">Nosotros</a></li>
          <li><a href="#">Trabaja con nosotros</a></li>
          <li><a href="#">Politicas de privacidad</a></li>
        </ul>
      </div>
      <div class="box">
        <p class="info-sociales">
          Síguenos si amas las películas o quieres enterarte de nuestras promociones, concursos y más.
        </p>
        <div class="iconos-sociales">
          <div class="facebook">
            <a href="#" class="icon">
              <i class="fa-brands fa-facebook-square"></i>
            </a>
            <p class="overly">
              Facebook
            </p>
          </div>
          <div class="twitter">
            <a href="#" class="icon">
              <i class="fa-brands fa-twitter"></i>
            </a>
            <p class="overly">
              Twitter
            </p>
          </div>
          <div class="youtube">
            <a href="#" class="icon">
              <i class="fa-brands fa-youtube"></i>
            </a>
            <p class="overly">
              YouTube
            </p>
          </div>
        </div>
        <div class="email">
          <a href="#" class="icon">
            <i class="fa-solid fa-square-envelope"></i>
          </a>
          <p class="info-sociales">
            Atencion de consultas o incidencias por favor Contactenos
          </p>
        </div>
      </div>
      <div class="box">
        <p class="info-sociales">
          El universo Breaking movie también está al alcance de tus dedos.
        </p>
        <p class="store">
          <a href="#">
            <img class="icon" src="../img/PlayStore.png" alt="Cargando imagen">
          </a>
          <a href="#">
            <img class="icon" src="../img/AppStore.png" alt="Cargando Imagen">
          </a>
        </p>
        <h2>Informacion publica de Breaking Movie</h2>
        <p class="info-sociales">
          Para acceder a nuestra información pública que se difunde en el Portal del Mercado de Valores hacer
          <a href="#">click aquí.</a>
        </p>
      </div>
    </div>
    <div class="grupo-2">
      <p>
        <small>&copy; 2022 - <b>Breaking Movie</b> - Todos los Derechos Reservados</small>
      </p>
    </div>
  </footer>
  <!--FIN DE PIE DE PAGINA-->

  <script>
    function showCart(x) {
      document.getElementById("products-id").style.display = "block";
    }
    function closeBtn() {
      document.getElementById("products-id").style.display = "none";
    }
  </script>

  <script type="module">

    /************** INICIO DE FIREBASE ***************/
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    import { getFirestore, doc, setDoc, collection, addDoc, getDocs, query, where, onSnapshot, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.9.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA4hxr_O3YEBZkxvgiFMeR3K7i4lXgEKSs",
      authDomain: "brakin-movie.firebaseapp.com",
      projectId: "brakin-movie",
      storageBucket: "brakin-movie.appspot.com",
      messagingSenderId: "860951424182",
      appId: "1:860951424182:web:3e7472203eb37cc2b6ca17"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Initialize Cloud Firestore and get a reference to the service
    const db = getFirestore(app);

    /********************** INICIO DE CODIFICACIONES *****************/

    /*function showCart(x) {
        document.getElementById("products-id").style.display = "block";
    }
    function closeBtn() {
        document.getElementById("products-id").style.display = "none";
    }*/
    /************* Custon **********/

    //variables
    let allContainerCart = document.querySelector('.products');
    let containerBuyCart = document.querySelector('.card-items');
    let priceTotal = document.querySelector('.price-total')
    let amountProduct = document.querySelector('.count-product');

    let contarTitulos = document.querySelectorAll('.title');

    let buyThings = [];
    let totalCard = 0;
    let countProduct = 0;

    //functions
    loadEventListenrs();
    function loadEventListenrs() {
      allContainerCart.addEventListener('click', addProduct);

      containerBuyCart.addEventListener('click', deleteProduct);
    }

    function addProduct(e) {
      e.preventDefault();
      if (e.target.classList.contains('btn-add-cart')) {
        const selectProduct = e.target.parentElement;
        readTheContent(selectProduct);
      }
    }

    function deleteProduct(e) {
      if (e.target.classList.contains('delete-product')) {
        const deleteId = e.target.getAttribute('data-id');

        buyThings.forEach(value => {
          if (value.id == deleteId) {
            let priceReduce = parseFloat(value.price) * parseFloat(value.amount);
            totalCard = totalCard - priceReduce;
            totalCard = totalCard.toFixed(2);
          }
        });
        buyThings = buyThings.filter(product => product.id !== deleteId);

        countProduct--;
      }
      loadHtml();
    }

    function readTheContent(product) {
      const infoProduct = {
        image: product.querySelector('div img').src,
        title: product.querySelector('.title').textContent,
        price: product.querySelector('div p span').textContent,
        id: product.querySelector('a').getAttribute('data-id'),
        amount: 1
      }

      totalCard = parseFloat(totalCard) + parseFloat(infoProduct.price);
      totalCard = totalCard.toFixed(2);

      const exist = buyThings.some(product => product.id === infoProduct.id);
      if (exist) {
        const pro = buyThings.map(product => {
          if (product.id === infoProduct.id) {
            product.amount++;
            return product;
          } else {
            return product
          }
        });
        buyThings = [...pro];
      } else {
        buyThings = [...buyThings, infoProduct]
        countProduct++;
      }
      loadHtml();
    }

    function loadHtml() {
      clearHtml();
      buyThings.forEach(product => {
        const { image, title, price, amount, id } = product;
        const row = document.createElement('div');
        row.classList.add('item');
        row.innerHTML = `
              <img src="${image}" alt="">
              <div class="item-content">
                  <h5>${title}</h5>
                  <h5 class="cart-price">S/${price}</h5>
                  <h6>Cantidad: ${amount}</h6>
              </div>
              <span class="delete-product" data-id="${id}">X</span>
          `;

        containerBuyCart.appendChild(row);
        priceTotal.innerHTML = totalCard;
        amountProduct.innerHTML = countProduct;
      });

    }
    function clearHtml() {
      containerBuyCart.innerHTML = '';
    }

    /************* COMPRAR **********/

    const botonComprar = document.querySelector('#btn-comprar');
    const limpiarCaja = document.getElementsByClassName('alm-tem');

    botonComprar.addEventListener('click', async () => {
      const cantidadProductos = document.querySelectorAll('.item');
      const cantidadItems = document.querySelectorAll('.item-content');
      const clearPrecio = document.querySelector('#idPrecio');
      if (clearPrecio.textContent === 0 || clearPrecio.textContent === '0') {
        alert('No ha seleccionado ningun producto');
      } else {
        for (let i = 0; i <= cantidadProductos.length - 1; i++) {
          let lugarProducto = cantidadProductos[i].children; //div class='item'(2)
          console.log(lugarProducto);

          let detalleProducto = lugarProducto[1].children
          //console.log(lugarProducto[1].children);

          document.querySelector('#txt-prueba').value = detalleProducto[0].textContent;
          document.querySelector('#txt-prueba2').value = detalleProducto[1].textContent;
          document.querySelector('#txt-prueba3').value = detalleProducto[2].textContent;

          const nombre = document.querySelector('#txt-prueba').value;
          const precio = document.querySelector('#txt-prueba2').value;
          const cantidad = document.querySelector('#txt-prueba3').value;

          //************* para agrgar los datos a FIREBSE*********
          const respuestas = await addDoc(collection(db, "Tareas"), {
            nom: nombre,
            prec: precio,
            cant: cantidad,
          });

          if (i <= cantidadProductos.length - 1) {
            limpiarCaja.value = '';
          }

          if (i === cantidadProductos.length - 1) {
            containerBuyCart.innerHTML = '';
            clearPrecio.textContent = 0;
          }
        }
      }
    })
  </script>

  <script src="../js/login.js"></script>
</body>

</html>